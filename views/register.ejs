<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Registration Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  </head>
  <body>
      <div class="container-fluid my-5 pb-1 px-1 w-50 h-50 border rounded bg-gray text-bg-info shadow">
        <h1 class="text-center text-light display-3 border-bottom border-3">Registration Form</h1>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active text-dark" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Profile</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link text-dark" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="true">Contact</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link text-dark" id="grade-tab" data-bs-toggle="tab" data-bs-target="#grade-tab-pane" type="button" role="tab" aria-controls="grade-tab-pane" aria-selected="false">Education & Skills</button>
            </li>
        </ul>
        <div class="tab-content text-bg-light p-2" id="myTabContent">
            <div class="tab-pane fade show active" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                <form class="row g-3" id="firstForm" onsubmit="event.preventDefault(); handleFirstNext();">
                <!-- <form class="row g-3" id="firstForm"> -->
                    <div class="col-md-4">
                        <label for="inputFName" class="form-label">First Name</label>
                        <input type="text" class="form-control" name="fName" id="inputFName" required>
                    </div>
                    <div class="col-md-4">
                        <label for="inputMName" class="form-label">Middle Name</label>
                        <input type="text" class="form-control" name="mName" id="inputMName">
                    </div>
                    <div class="col-md-4">
                        <label for="inputLName" class="form-label">Last Name</label>
                        <input type="text" class="form-control" name="lName" id="inputLName">
                    </div>
                    <div class="col-md-3">
                        <label for="inputDOB" class="form-label">Date of Birth</label>
                        <input type="date" min="0" class="form-control" name="dob" id="inputDOB" required>
                    </div>
                    <div class="col-12">
                        <div class="col-md-2">
                            <label for="inputGender" class="form-label">Gender</label>
                            <select id="inputGender" class="form-select" name="gender" required>
                            <option>Female</option>
                            <option>Male</option>
                            <option>Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary" id="firstNext">Next</button>
                    </div>
                </form>
            </div>
            
            <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
                <form class="row g-3" id="secondForm" onsubmit="event.preventDefault(); handleSecondNext();">
                    <div class="col-md-6">
                        <label for="inputEmail4" class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" id="inputEmail4" required>
                    </div>
                    <div class="col-md-6">
                        <label for="inputPassword4" class="form-label">Password</label>
                        <input type="password" class="form-control" name="password" id="inputPassword4" required>
                    </div>
                    <div class="col-md-4">
                        <label for="inputNumber" class="form-label">Mobile Number</label>
                        <div class="input-group">
                            <span class="input-group-text" id="basic-addon1">+91</span>
                            <input type="number" class="form-control" min="1000000000" max="9999999999" id="inputNumber" name="phone" required>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Address</label>
                        <input type="text" class="form-control" id="inputAddress" name="addr1" placeholder="Apartment, studio, or floor" required>
                    </div>
                    <div class="col-12">
                        <label for="inputAddress2" class="form-label">Address 2</label>
                        <input type="text" class="form-control" id="inputAddress2" name="addr2" placeholder="1234 Main St" required>
                    </div>
                    <div class="col-md-6">
                        <label for="inputCity" class="form-label">City</label>
                        <input type="text" class="form-control" id="inputCity" name="city" required>
                    </div>
                    <div class="col-md-4">
                        <label for="inputState" class="form-label">State</label>
                        <select id="inputState" class="form-select" name="state" required>
                        <option>Andaman Nicobar Islands</option>
                        <option>Andhra Pradesh</option>
                        <option>Arunachal Pradesh</option>
                        <option>Assam</option>
                        <option>Bihar</option>
                        <option>Chandigarh</option>
                        <option>Chattisgarh</option>
                        <option>Dadra Nagar Haveli</option>
                        <option>Daman Diu</option>
                        <option>Delhi</option>
                        <option>Goa</option>
                        <option>Gujarat</option>
                        <option>Haryana</option>
                        <option>Himachal Pradesh</option>
                        <option>Jammu Kashmir</option>
                        <option>Jharkhand</option>
                        <option>Karnataka</option>
                        <option>Kerala</option>
                        <option>Lakshadweep</option>
                        <option>Madhya Pradesh</option>
                        <option>Maharashtra</option>
                        <option>Manipur</option>
                        <option>Meghalaya</option>
                        <option>Mizoram</option>
                        <option>Nagaland</option>
                        <option>Odisha</option>
                        <option>Pondicherry</option>
                        <option>Punjab</option>
                        <option>Rajasthan</option>
                        <option>Sikkim</option>
                        <option>Tamil Nadu</option>
                        <option>Telangana</option>
                        <option>Tripura</option>
                        <option>Uttar Pradesh</option>
                        <option>Uttarakhand</option>
                        <option>West Bengal</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="inputZip" class="form-label">Pincode</label>
                        <input type="number" min="110001" max="855117" name="pincode" class="form-control" id="inputZip" required>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Next</button>
                    </div>
                </form>
            </div>
            <div class="tab-pane fade" id="grade-tab-pane" role="tabpanel" aria-labelledby="grade-tab" tabindex="0">
                <form class="row g-3" action="/success" method="get" id="finalForm" onsubmit="event.preventDefault(); handleSub();">
                    <div class="col-md-3">
                        <label for="input10th" class="form-label">10th Percentage</label>
                        <input type="number" min="0" max="100" step="0.01" name="tenth" class="form-control w-50" id="input10th" required>
                    </div>
                    <div class="col-md-3">
                        <label for="input12th" class="form-label">12th Percentage</label>
                        <input type="number" min="0" max="100" step="0.01" name="twelth" class="form-control w-50" id="input12th" required>
                    </div>
                    <div class="col-12">
                        <div class="col-md-3">
                            <label for="inputSem" class="form-label">Current Semester</label>
                            <select id="inputSem" class="form-control w-50" name="sem" onchange="handleSems()" onload="handleSems()">
                                <option>I</option>
                                <option selected>II</option>
                                <option>III</option>
                                <option>IV</option>
                                <option>V</option>
                                <option>VI</option>
                                <option>VII</option>
                                <option>VIII</option>
                            </select>
                        </div>
                    </div>
                    <div id="semPointers" class="row g-4 mt-1">
                        <div class="col-md-3">
                            <label for="inputSem1" class="form-label">Sem 1 SPI</label>
                            <input type="number" min="0" max="10" step="0.01" class="form-control w-50" id="inputSem1" name="inputSem1" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="resumeOption">Resume Google Drive Link</label>
                        <input type="text" class="form-control form-control-sm text-primary" name="resume" id="resumeOption">
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function handleSems() {
            num = document.getElementById('inputSem').value;
            if(num === 'I')  num = 1;
            else if(num === 'II') num = 2;
            else if(num === 'III') num = 3;
            else if(num === 'IV') num = 4;
            else if(num === 'V') num = 5;
            else if(num === 'VI') num = 6;
            else if(num === 'VII') num = 7;
            else if(num === 'VIII') num = 8;
            
            marksDiv = document.getElementById('semPointers');
            marksDiv.innerHTML = "";
            
            let temp = "";
            
            for(let i = 1; i < num; i++) {
                temp += "<div class=\"col-md-3\"> <label for=\"inputSem"+String(i)+"\" class=\"form-label\">Sem "+ String(i) +" SPI</label><input type=\"number\" min=\"0\" max=\"10\" step=\"0.01\" class=\"form-control w-50\" id=\"inputSem"+String(i)+"\" name=\"inputSem"+String(i)+"\" required></div>"
            }
            
            marksDiv.innerHTML = temp;
        }
        
        function handleFirstNext() {
            document.getElementById('profile-tab-pane').classList.remove('show');
            document.getElementById('profile-tab-pane').classList.remove('active');
            document.getElementById('profile-tab').classList.remove('active');
            document.getElementById('contact-tab-pane').classList.add('show');
            document.getElementById('contact-tab-pane').classList.add('active');
            document.getElementById('contact-tab').classList.add('active');
        }

        function handleSecondNext() {
            document.getElementById('contact-tab-pane').classList.remove('show');
            document.getElementById('contact-tab-pane').classList.remove('active');
            document.getElementById('contact-tab').classList.remove('active');
            document.getElementById('grade-tab-pane').classList.add('show');
            document.getElementById('grade-tab-pane').classList.add('active');
            document.getElementById('grade-tab').classList.add('active');
        }

        async function handleSub() {
            inputs = document.querySelectorAll("input");
            selects = document.querySelectorAll("select");
            let done = true;
            let d = {};
            inputs.forEach(async element => {
                if(element.name != 'resume' && element.name != 'lName' && element.name != 'mName' && element.value === '') {
                    done = false;
                }
                d[element.name] = element.value;
            });
            selects.forEach(element => {
                d[element.name] = element.value;
            });

            if(done) {
                let valid = await checkMobileNumber(document.getElementById('inputNumber').value);
                if(!valid) {
                    alert('The mobile number entered is not a valid Indian phone number. Please enter a valid mobile number');
                    return;
                }   

                valid = await checkEmail(document.getElementById('inputEmail4').value);
                if(!valid) {
                    alert('The email entered is not valid. Please enter a valid email id');
                    return;
                }   

                await fetch("/register", {
                    method: "POST",
                    body: JSON.stringify(d),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                });
                
                document.getElementById("finalForm").submit();
            }
            else
                alert('Please fill all the required fields!');
            
        }

        async function checkMobileNumber(number) {
            const url = 'https://phonenumbervalidatefree.p.rapidapi.com/ts_PhoneNumberValidateTest.jsp?number=%2B91' + number + '&country=IN';
            const options = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': '<%= api_key %>',
                    'X-RapidAPI-Host': 'phonenumbervalidatefree.p.rapidapi.com'
                }
            };

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                console.log(result.isValidNumber);
                console.log(result.isValidNumberForRegion);
                return result.isValidNumber && result.isValidNumberForRegion;
            } catch (error) {
                console.error(error);
            }

            return false;
        }

        async function checkEmail(mail) {
            const url = 'https://api.zerobounce.net/v2/validate?api_key=<%= z_api_key %>&email=' + mail + '&ip_address=156.124.12.145';
            const options = {
                method: 'GET'
            };

            try {
                const response = await fetch(url, options);
                const result = await response.text();
                console.log(result);
            } catch (error) {
                console.error(error);
            }

            return status === 'valid';
        }

    </script>
  </body>
</html>